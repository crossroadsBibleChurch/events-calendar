<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>DAKboard 2026 - Black BG Fixed</title>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@fullcalendar/google-calendar@6.1.15/index.global.min.js"></script>

    <style>
        body { margin: 0; padding: 0; font-family: sans-serif; background: #000; color: #eee; }
        #calendar { max-width: 100%; height: auto; padding: 5px 20px; }

        /* Header & Sync Swap Logic */
        .fc-header-toolbar { margin-bottom: 10px !important; padding: 5px 0 !important; }
        #refreshInfo { font-size: 0.9em; color: #555; order: 3; padding-right: 10px; }

        /* Shading for Active Days */
        .fc-daygrid-day:not(.fc-day-other) { background: #1a1a1a !important; }
        .fc-day-other .fc-daygrid-day-number { color: #444 !important; }

        /* Year View Scaling */
        .fc-multimonth { font-size: 0.85em !important; }
        .fc-multimonth-daygrid-day.fc-day-other .fc-daygrid-event { display: none !important; }

        /* Month View 4:3 Aspect Ratio */
        #zoomCalendar .fc-daygrid-day-frame { aspect-ratio: 4 / 3 !important; }
        #zoomCalendar .fc { font-size: 1.62em !important; line-height: 1.1 !important; }

        /* --- EVENT ENGINE --- */
        .fc-daygrid-event { 
            display: flex !important; 
            align-items: center !important; 
            margin: 1px 5px !important; /* 5px breathing space L/R */
            padding: 0 !important;
            width: calc(100% - 10px) !important;
            overflow: hidden !important;
            white-space: nowrap !important;
            cursor: pointer !important;
        }

        /* Timed Events: Text only, no chips */
        .fc-daygrid-event:not(.fc-event-all-day) { background: transparent !important; border: none !important; }

        /* All-Day Events: Grey Chips with Lighter Borders */
        .fc-event-all-day {
            background: rgba(120, 120, 120, 0.4) !important; 
            border: 1px solid #aaa !important; 
            border-radius: 4px !important;
            padding: 2px 4px !important;
        }

        .fc-event-time { 
            color: #dcdcdc !important; 
            font-weight: 700 !important; 
            font-size: 0.75em !important; 
            width: 42px !important; 
            flex-shrink: 0;
            margin-right: 6px !important; /* 6px breathing space between time and title */
        }

        .fc-event-title { 
            color: #8fc7ff !important; 
            font-weight: bold !important; 
            overflow: hidden !important; 
            text-overflow: clip !important; /* Truncate without ellipses */
            flex-grow: 1;
        }

        /* Overlays & Modals */
        .zoom-container { display: none; position: fixed; background: rgba(0,0,0,0.98); z-index: 2000; left: 2%; top: 2%; width: 96%; height: 96vh; border: 2px solid #555; border-radius: 15px; padding: 30px; overflow-y: auto; }
        #closeZoom { position: absolute; top: 15px; right: 20px; background: #c0392b; color: #fff; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; z-index: 2100; font-weight: bold; }
        #customModal { display: none; position: fixed; z-index: 3000; left: 50%; top: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 600px; background: #1a1a1a; border: 2px solid #8fc7ff; border-radius: 20px; padding: 40px; box-shadow: 0 0 50px #000; }
    </style>
</head>
<body>
    <div style="display: none;"><div id="refreshInfo">Sync: <span id="lastUpdate">--:--</span></div></div>
    <div id="calendar"></div>
    <div id="zoomOverlay" class="zoom-container"><button id="closeZoom" onclick="closeZoom()">CLOSE X</button><div id="zoomCalendar"></div></div>
    
    <div id="customModal">
        <h3 id="mTitle" style="margin-top:0; color:#8fc7ff;"></h3>
        <p id="mTime" style="color:#aaa; font-weight:bold;"></p>
        <div id="mDesc" style="color:#ddd; margin-bottom:20px;"></div>
        <button style="float:right; background:#444; color:#fff; border:none; padding:10px 20px; border-radius:5px; cursor:pointer;" onclick="closeModal()">Close</button>
    </div>

    <script>
        var mainCal, zoomCal;
        var API_KEY = 'AIzaSyD1icSp6SOC9A0yIsy0rGk0mr1B60sW2Zo';
        var CAL_ID = 'eventsatcrossroads@gmail.com';

        function formatTime(arg) {
            if (arg.event.allDay) return "ALL";
            let d = arg.event.start;
            let h = d.getHours() % 12 || 12;
            let m = d.getMinutes().toString().padStart(2, '0');
            return h + ':' + m + (d.getHours() >= 12 ? 'p' : 'a');
        }

        function closeModal() { document.getElementById('customModal').style.display = 'none'; }
        function closeZoom() { document.getElementById('zoomOverlay').style.display = 'none'; document.body.style.overflow = 'auto'; }

        function showDetails(info) {
            info.jsEvent.preventDefault();
            const event = info.event;
            document.getElementById('mTitle').innerText = event.title;
            const timeStr = event.allDay ? "All Day Event" : event.start.toLocaleString([], { weekday: 'short', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            document.getElementById('mTime').innerText = timeStr;
            document.getElementById('mDesc').innerHTML = (event.extendedProps.description || "No description provided.").replace(/\n/g, "<br>");
            document.getElementById('customModal').style.display = 'block';
        }

        function initCalendar(el, view, date) {
            return new FullCalendar.Calendar(el, {
                googleCalendarApiKey: API_KEY,
                eventSources: [{ googleCalendarId: CAL_ID }],
                initialView: view,
                initialDate: date || new Date(),
                multiMonthMaxColumns: 3,
                headerToolbar: { left: 'prev,next today', center: 'title', right: '' },
                
                // FIXED BACKGROUND LOGIC
                dayCellDidMount: function(info) {
                    if (info.isOther) {
                        info.el.style.setProperty('background-color', '#000000', 'important');
                    }
                },

                eventClick: showDetails,
                eventContent: function(arg) {
                    let timeText = formatTime(arg);
                    let isAllDay = arg.event.allDay;
                    return { html: `<div class="fc-event-time" style="width:${isAllDay ? 'auto' : '42px'} !important;">${timeText}</div><div class="fc-event-title">${arg.event.title}</div>` };
                },
                loading: (isLoading) => {
                    if (!isLoading && el.id === 'calendar') {
                        document.getElementById('lastUpdate').innerText = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                        const target = document.querySelector('.fc-toolbar-chunk:last-child');
                        if(target) target.appendChild(document.getElementById('refreshInfo'));
                    }
                }
            });
        }

        window.onload = function() {
            mainCal = initCalendar(document.getElementById('calendar'), 'multiMonthYear');
            mainCal.render();
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('fc-multimonth-title')) {
                    document.getElementById('zoomOverlay').style.display = 'block';
                    document.body.style.overflow = 'hidden';
                    if (zoomCal) zoomCal.destroy();
                    zoomCal = initCalendar(document.getElementById('zoomCalendar'), 'dayGridMonth', new Date(e.target.innerText + ", " + mainCal.view.title));
                    zoomCal.render();
                }
            });
        };
    </script>
</body>
</html>
